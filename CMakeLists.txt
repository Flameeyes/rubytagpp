PROJECT(RUBYTAGPP)

SET(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMakeModules ${CMAKE_MODULE_PATH})

FIND_PACKAGE(Ruby REQUIRED)
FIND_PACKAGE(TagLib REQUIRED)

ADD_CUSTOM_COMMAND(
	OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/rubytag.cpp
	COMMAND ${RUBY_EXECUTABLE}
	ARGS -C${CMAKE_CURRENT_SOURCE_DIR}/generator ${CMAKE_CURRENT_SOURCE_DIR}/generator/generator.rb ${CMAKE_CURRENT_SOURCE_DIR}/generator/description.yml
	DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/generator/generator.rb ${CMAKE_CURRENT_SOURCE_DIR}/generator/description.yml
)

INCLUDE_DIRECTORIES(${TAGLIB_INCLUDE_DIR}/taglib ${RUBY_INCLUDE_PATH})

ADD_LIBRARY(rubytagpp rubytag.cpp)
TARGET_LINK_LIBRARIES(rubytagpp ${TAGLIB_LIBRARIES})
